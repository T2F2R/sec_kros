<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Отчеты - Админ панель</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    .report-card {
        transition: transform 0.2s;
    }
    .report-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    .date-input-group {
        max-width: 300px;
    }
  </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
  <div class="container">
    <a class="navbar-brand" href="/admin/dashboard">
      <i class="fas fa-shield-alt"></i> SEC - Админ панель
    </a>
    <div class="navbar-nav ms-auto">
            <span class="navbar-text text-white me-3">
                <i class="fas fa-user-tie"></i>
                <span th:text="${employee.firstName + ' ' + employee.lastName}">Администратор</span>
            </span>
      <form th:action="@{/logout}" method="post" class="d-inline">
        <button type="submit" class="btn btn-link text-white nav-link p-0"
                style="background: none; border: none; cursor: pointer;">
          <i class="fas fa-sign-out-alt"></i> Выйти
        </button>
      </form>
    </div>
  </div>
</nav>

<div class="container-fluid mt-4">
  <div class="row">
    <!-- Sidebar -->
    <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
      <div class="position-sticky pt-3">
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link" href="/admin/dashboard">
              <i class="fas fa-tachometer-alt"></i> Обзор
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/clients">
              <i class="fas fa-users"></i> Клиенты
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/contracts">
              <i class="fas fa-file-contract"></i> Договоры
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/objects">
              <i class="fas fa-building"></i> Объекты
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/employees">
              <i class="fas fa-user-tie"></i> Сотрудники
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="/admin/reports">
              <i class="fas fa-chart-bar"></i> Отчеты
            </a>
          </li>
        </ul>
      </div>
    </nav>

    <!-- Main content -->
    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">
          <i class="fas fa-chart-bar"></i> Отчеты
        </h1>
      </div>

      <!-- Информационное сообщение -->
      <div class="alert alert-info">
        <h5 class="alert-heading">
          <i class="fas fa-info-circle"></i> Генерация отчетов
        </h5>
        <p class="mb-0">
          Выберите тип отчета и временной период для генерации. Отчеты будут скачаны в формате Excel.
        </p>
      </div>

      <!-- Общие параметры периода -->
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-calendar-alt"></i> Выберите период для отчетов
          </h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="startDate" class="form-label">Дата начала периода *</label>
                <input type="date" class="form-control" id="startDate"
                       th:value="${#temporals.format(#temporals.createNow().minusMonths(1), 'yyyy-MM-dd')}"
                       required>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="endDate" class="form-label">Дата окончания периода *</label>
                <input type="date" class="form-control" id="endDate"
                       th:value="${#temporals.format(#temporals.createNow(), 'yyyy-MM-dd')}"
                       required>
              </div>
            </div>
          </div>
          <div class="alert alert-warning">
            <small>
              <i class="fas fa-exclamation-triangle"></i>
              Для генерации отчетов обязательно выберите период времени.
            </small>
          </div>
        </div>
      </div>

      <!-- Карточки с отчетами -->
      <div class="row">
        <!-- Отчет по выручке -->
        <div class="col-md-4 mb-4">
          <div class="card report-card h-100 border-success">
            <div class="card-header bg-success text-white">
              <h5 class="mb-0">
                <i class="fas fa-money-bill-wave"></i> Отчет по выручке
              </h5>
            </div>
            <div class="card-body">
              <p class="card-text">
                Содержит информацию о всех договорах за выбранный период с расчетом общей выручки.
              </p>
              <ul class="list-unstyled">
                <li><i class="fas fa-check text-success"></i> Детализация по договорам</li>
                <li><i class="fas fa-check text-success"></i> Расчет общей выручки</li>
                <li><i class="fas fa-check text-success"></i> Статусы договоров</li>
              </ul>
            </div>
            <div class="card-footer bg-transparent">
              <form id="revenueReportForm" method="post" th:action="@{/admin/reports/revenue}">
                <input type="hidden" name="startDate" id="revenueStartDate">
                <input type="hidden" name="endDate" id="revenueEndDate">
                <button type="button" class="btn btn-success w-100" onclick="generateRevenueReport()">
                  <i class="fas fa-download"></i> Скачать отчет
                </button>
              </form>
            </div>
          </div>
        </div>

        <!-- Отчет по договорам -->
        <div class="col-md-4 mb-4">
          <div class="card report-card h-100 border-primary">
            <div class="card-header bg-primary text-white">
              <h5 class="mb-0">
                <i class="fas fa-file-contract"></i> Отчет по договорам
              </h5>
            </div>
            <div class="card-body">
              <p class="card-text">
                Детальный отчет по всем заключенным договорам с информацией о клиентах и услугах.
              </p>
              <ul class="list-unstyled">
                <li><i class="fas fa-check text-primary"></i> Информация о клиентах</li>
                <li><i class="fas fa-check text-primary"></i> Детали услуг</li>
                <li><i class="fas fa-check text-primary"></i> Даты и статусы</li>
              </ul>
            </div>
            <div class="card-footer bg-transparent">
              <form id="contractsReportForm" method="post" th:action="@{/admin/reports/contracts}">
                <input type="hidden" name="startDate" id="contractsStartDate">
                <input type="hidden" name="endDate" id="contractsEndDate">
                <button type="button" class="btn btn-primary w-100" onclick="generateContractsReport()">
                  <i class="fas fa-download"></i> Скачать отчет
                </button>
              </form>
            </div>
          </div>
        </div>

        <!-- Отчет по клиентам -->
        <div class="col-md-4 mb-4">
          <div class="card report-card h-100 border-info">
            <div class="card-header bg-info text-white">
              <h5 class="mb-0">
                <i class="fas fa-users"></i> Отчет по клиентам
              </h5>
            </div>
            <div class="card-body">
              <p class="card-text">
                Список всех клиентов, зарегистрированных в системе за выбранный период времени.
              </p>
              <ul class="list-unstyled">
                <li><i class="fas fa-check text-info"></i> Контактная информация</li>
                <li><i class="fas fa-check text-info"></i> Дата регистрации</li>
                <li><i class="fas fa-check text-info"></i> Полные данные клиентов</li>
              </ul>
            </div>
            <div class="card-footer bg-transparent">
              <form id="clientsReportForm" method="post" th:action="@{/admin/reports/clients}">
                <input type="hidden" name="startDate" id="clientsStartDate">
                <input type="hidden" name="endDate" id="clientsEndDate">
                <button type="button" class="btn btn-info w-100" onclick="generateClientsReport()">
                  <i class="fas fa-download"></i> Скачать отчет
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- Быстрые периоды -->
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-bolt"></i> Быстрый выбор периода
          </h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-3 mb-2">
              <button type="button" class="btn btn-outline-secondary w-100" onclick="setPeriod('today')">
                Сегодня
              </button>
            </div>
            <div class="col-md-3 mb-2">
              <button type="button" class="btn btn-outline-secondary w-100" onclick="setPeriod('week')">
                Неделя
              </button>
            </div>
            <div class="col-md-3 mb-2">
              <button type="button" class="btn btn-outline-secondary w-100" onclick="setPeriod('month')">
                Месяц
              </button>
            </div>
            <div class="col-md-3 mb-2">
              <button type="button" class="btn btn-outline-secondary w-100" onclick="setPeriod('year')">
                Год
              </button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
      // Устанавливаем минимальную и максимальную даты
      const startDateInput = document.getElementById('startDate');
      const endDateInput = document.getElementById('endDate');

      // Максимальная дата - сегодня
      const today = new Date().toISOString().split('T')[0];
      startDateInput.max = today;
      endDateInput.max = today;

      // Валидация дат
      startDateInput.addEventListener('change', function() {
          if (endDateInput.value && startDateInput.value > endDateInput.value) {
              endDateInput.value = '';
          }
          endDateInput.min = startDateInput.value;
      });

      endDateInput.addEventListener('change', function() {
          if (startDateInput.value && endDateInput.value < startDateInput.value) {
              alert('Дата окончания не может быть раньше даты начала');
              endDateInput.value = '';
          }
      });
  });

  // Функции для генерации отчетов
  function generateRevenueReport() {
      if (validateDates()) {
          document.getElementById('revenueStartDate').value = document.getElementById('startDate').value;
          document.getElementById('revenueEndDate').value = document.getElementById('endDate').value;
          document.getElementById('revenueReportForm').submit();
      }
  }

  function generateContractsReport() {
      if (validateDates()) {
          document.getElementById('contractsStartDate').value = document.getElementById('startDate').value;
          document.getElementById('contractsEndDate').value = document.getElementById('endDate').value;
          document.getElementById('contractsReportForm').submit();
      }
  }

  function generateClientsReport() {
      if (validateDates()) {
          document.getElementById('clientsStartDate').value = document.getElementById('startDate').value;
          document.getElementById('clientsEndDate').value = document.getElementById('endDate').value;
          document.getElementById('clientsReportForm').submit();
      }
  }

  // Валидация дат
  function validateDates() {
      const startDate = document.getElementById('startDate').value;
      const endDate = document.getElementById('endDate').value;

      if (!startDate || !endDate) {
          alert('Пожалуйста, выберите период для отчета');
          return false;
      }

      if (startDate > endDate) {
          alert('Дата начала не может быть позже даты окончания');
          return false;
      }

      return true;
  }

  // Быстрые периоды
  function setPeriod(period) {
      const endDate = new Date();
      const startDate = new Date();

      switch(period) {
          case 'today':
              startDate.setDate(endDate.getDate());
              break;
          case 'week':
              startDate.setDate(endDate.getDate() - 7);
              break;
          case 'month':
              startDate.setMonth(endDate.getMonth() - 1);
              break;
          case 'year':
              startDate.setFullYear(endDate.getFullYear() - 1);
              break;
      }

      document.getElementById('startDate').value = startDate.toISOString().split('T')[0];
      document.getElementById('endDate').value = endDate.toISOString().split('T')[0];
  }
</script>
</body>
</html>